:root{
  --bg:#0f1115;
  --panel:#151923;
  --panel-2:#1a2030;
  --text:#e8ecf1;
  --muted:#a7b0c3;
  --accent:#4cc9f0;
  --accent-2:#b5179e;
  --danger:#ef476f;
  --ok:#06d6a0;
  --border:#252b3a;
  --focus:#ffd166;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  background:linear-gradient(120deg,#0f1115,#121625 50%,#0f1115);
  color:var(--text);
  font:500 14px/1.45 system-ui,Segoe UI,Roboto,Inter,Arial;
}

.topbar{
  height:56px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 12px;
  background:rgba(17,20,30,.7);
  backdrop-filter: blur(8px);
  border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:10;
}
.brand{display:flex;align-items:center;gap:10px}
.brand .logo{font-size:20px}
.brand h1{font-size:16px;margin:0}
.tagline{color:var(--muted);font-size:12px}
.top-actions{display:flex;gap:8px;align-items:center}
.top-actions button,.file-btn{padding:8px 12px;background:var(--panel);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer}
.top-actions .primary{background:linear-gradient(180deg,var(--accent),#2a9fd6);border-color:#177bbf}
.file-btn input{display:none}
.status{display:flex;align-items:center;gap:12px}
.badge{padding:4px 8px;background:var(--panel);border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted)}

.switch{position:relative;display:inline-block;width:44px;height:24px}
.switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#344;color:transparent;border-radius:12px;transition:.2s}
.slider:before{content:"";position:absolute;height:18px;width:18px;left:3px;top:3px;background:white;border-radius:50%;transition:.2s}
.switch input:checked + .slider{background:#1f6346}
.switch input:checked + .slider:before{transform:translateX(20px)}

.layout{display:grid;grid-template-columns:320px 1fr;gap:0;min-height:calc(100vh - 56px - 56px)}
.sidebar{
  background:rgba(21,25,35,.7);
  border-right:1px solid var(--border);
  overflow:auto;
  padding:12px;
}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:12px}
.panel h2,.panel h3{margin:6px 0 10px 0;font-size:14px}
.grid-1{display:grid;gap:8px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.grid-4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px}
.stack{display:flex;flex-direction:column;gap:8px}
label{display:flex;justify-content:space-between;align-items:center;gap:8px}
input[type="range"]{width:60%}
input[type="number"],select,textarea{width:100%;padding:8px;background:var(--panel-2);border:1px solid var(--border);border-radius:8px;color:var(--text)}
button{padding:8px 12px;background:var(--panel-2);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer}
button.primary{background:linear-gradient(180deg,#4cc9f0,#2a9fd6);border-color:#177bbf}
button:focus-visible, .file-btn:focus-visible, select:focus-visible, input:focus-visible, textarea:focus-visible{
  outline:2px solid var(--focus);outline-offset:2px
}
button:disabled{opacity:.5;cursor:not-allowed}
.checkbox{display:flex;align-items:center;gap:8px;color:var(--muted)}

.canvas-area{position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#0c0e14}
.canvas-wrap{position:relative;max-width:100%;max-height:100%;overflow:auto;border-left:1px solid var(--border)}
#mainCanvas,#overlayCanvas,#maskCanvas{display:block;max-width:none;max-height:none;position:absolute;left:0;top:0}
#overlayCanvas, #maskCanvas{pointer-events:none}

.preset-strip{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.preset{position:relative;border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;background:#0b0d12}
.preset canvas{width:100%;display:block}
.preset .name{position:absolute;left:6px;bottom:6px;font-size:11px;background:rgba(0,0,0,.45);padding:2px 6px;border-radius:6px}
.preset.selected{outline:2px solid var(--accent)}

.spinner{position:absolute;inset:auto 16px 16px auto;background:rgba(10,12,18,.7);border:1px solid var(--border);padding:10px;border-radius:12px;display:flex;gap:10px;align-items:center}
.spinner.hidden{display:none}
.loader{width:18px;height:18px;border-radius:50%;border:2px solid #2d3347;border-top-color:#9adbf7;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

.toast{position:absolute;left:50%;bottom:12px;transform:translateX(-50%);background:rgba(20,24,35,.9);border:1px solid var(--border);padding:10px 14px;border-radius:10px;opacity:0;transition:opacity .2s}
.toast.show{opacity:1}

.footer{
  height:56px;display:flex;align-items:center;justify-content:space-between;
  gap:12px;padding:0 12px;background:rgba(17,20,30,.7);
  border-top:1px solid var(--border)
}

.modal{border:none;border-radius:12px;padding:0;background:transparent}
.modal::backdrop{background:rgba(0,0,0,.55);backdrop-filter:blur(2px)}
.modal-inner{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:16px;width:min(560px,90vw)}
.modal h2{margin-top:0}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
.small{color:var(--muted);font-size:12px}
.prompt-examples summary{cursor:pointer}
.prompt-plan{margin-top:8px;background:var(--panel-2);border:1px solid var(--border);border-radius:10px;padding:8px;color:var(--muted)}
.hint{color:var(--muted)}

.file-btn.small{font-size:12px;padding:6px 10px}

@media (max-width: 980px){
  .layout{grid-template-columns:1fr;grid-template-rows:auto 1fr}
  .sidebar{position:sticky;top:56px;z-index:5}
  .preset-strip{grid-template-columns:repeat(2,1fr)}
}